stages:
  - canary
  - close

.canary:
  stage: canary
  rules:
    - if: '$CI_COMMIT_TAG =~ /release\/canary\/\d\.\d$/'
  variables:
    CANARY: 0
  when: manual

canary_0:
  extends: .canary
  script:
    - echo "Canary $CANARY%"

canary_10:
  extends: .canary
  variables:
    CANARY: 10
  script:
    - echo "Canary $CANARY%"

canary_50:
  extends: .canary
  variables:
    CANARY: 50
  script:
    - echo "Canary $CANARY%"

canary_100:
  extends: .canary
  variables:
    CANARY: 100
  script:
    - echo "Canary $CANARY%"

release image:
  stage: close
  when: always
  script:
    - echo "Making image for prod"

production:
  stage: close
  when: always
  script:
    - echo "Deploying image on prod"

close release:
  stage: close
  when: manual
  script:
    - echo "Closing release"